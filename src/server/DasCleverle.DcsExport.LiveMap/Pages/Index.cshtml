@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

@section Scripts {
    <script src="~/js/map.js"></script>
    <script src="~/js/index.js"></script>
}

<div class="map-container">
    <div id="map" class="map" data-token="@Model.MapboxToken" data-style="@Model.MapboxStyle"></div>
    <div class="sidebar">
        <div id="sidebar-mission-properties"></div>
        <div id="sidebar-airbase-properties"></div>
    </div>
    <div id="loading" class="loading" style="display: none">
        <div class="backdrop"></div>
        <div class="loading-content">
            <div id="spinner" class="spinner-border" style="width: 5rem; height: 5rem"></div>
            <div id="error" class="alert alert-danger text-center mt-3" style="display: none;"></div>
        </div>
    </div>
</div>

<script type="text/template" data-template="connection-reconnecting">
    Die Verbindung zum Server ist abgebrochen. Versuche erneute Verbindung ...
</script>

<script type="text/template" data-template="connection-error">
    Die Verbindung konnte nicht hergestellt werden.
</script>

<script type="text/template" data-template="feature-popup">
    <div $for="feature of features" class="mt-2">
        <div class="mt-1">
            <strong>${feature.typeName}</strong><br/>
            ${feature.name}
        </div>
    </div>
</script>

<script type="text/template" data-template="mission-properties">
    <div class="card property-card">
        <div class="card-header">
            Aktuelle Mission
        </div>

        <div class="card-body">
            <div class="property-title">Mission</div>
            ${missionName}

            <div class="property-title">Theatre</div>
            ${theatre}
        </div>
    </div>
</script>

<script type="text/template" data-template="airbase-properties">
    <div class="card property-card">
        <div class="card-header">
            Ausgewähltes Airfield
        </div>

        <div class="card-body">
            <div class="property-title">Name</div>
            ${name}
        
            <div class="property-title">Tower</div>
            ${frequencies.map(formatFrequency).join(', ')}
        
            <div $if="runways.length">
                <div class="property-title">Runways</div>

                <div class="row">
                    <div class="col" $for="runway of runways">
                        <div>
                            <strong>${runway.edge1}</strong> 
                            ${ilsByRwy[runway.edge1] && '(ILS: ' + formatFrequency(ilsByRwy[runway.edge1]) + ')'}
                        </div>
                    </div>
                    <div class="col" $for="runway of runways">
                        <div>
                            <strong>${runway.edge2}</strong> 
                            ${ilsByRwy[runway.edge2] && '(ILS: ' + formatFrequency(ilsByRwy[runway.edge2]) + ')'}
                        </div>
                    </div>
                </div>
            </div>
        
            <div $if="beacons.tacan.length">
                <div class="property-title">TACAN</div>
                ${beacons.tacan.map(t => t.channel + t.mode + ' (' + t.callsign + ')').join(', ')}
            </div>

            <div $if="beacons.vor.length">
                <div class="property-title">VOR</div>
                ${beacons.vor.map(x => formatFrequency(x.frequency) + ' (' + x.callsign + ')').join(', ')}
            </div>

            <div $if="beacons.ndb.length">
                <div class="property-title">NDB</div>
                ${beacons.ndb.map(x => formatFrequency(x.frequency) + ' (' + x.callsign + ')').join(', ')}
            </div>
        </div>
    </div>
</script>